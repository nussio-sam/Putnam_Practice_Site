{
  "year": "2008",
  "question_number": "3",
  "domain": "Putnam",
  "statement": "",
  "solution": [
    {
      "hint_level": 0,
      "content": "We first prove that the process stops. Note first that the product\n$a_1 \\cdots a_n$ remains constant, because\n$a_j a_k = \\gcd(a_j, a_k) \\lcm(a_j, a_k)$. Moreover,\nthe last number in the sequence can never decrease, because it is always\nreplaced by its least common multiple with another number.\nSince it is bounded above (by the product\nof all of the numbers), the last number must eventually reach its\nmaximum value, after which it remains constant throughout. After this\nhappens, the next-to-last number will never decrease, so it eventually\nbecomes constant, and so on. After finitely many steps, all of the numbers\nwill achieve their final values, so\nno more steps will be possible. This only happens when\n$a_j$ divides $a_k$ for all pairs $j < k$.\n\nWe next check that there is only one possible final sequence.\nFor $p$ a prime and $m$ a nonnegative integer, we claim that the number\nof integers in the list divisible by $p^m$ never changes. To see this,\nsuppose we replace $a_j, a_k$ by $\\gcd(a_j, a_k),\\lcm(a_j,a_k)$.\nIf neither of $a_j, a_k$ is divisible by $p^m$, then neither of\n$\\gcd(a_j, a_k),\\lcm(a_j,a_k)$ is either.\nIf exactly one $a_j, a_k$ is divisible by $p^m$, then\n$\\lcm(a_j,a_k)$ is divisible by $p^m$ but $\\gcd(a_j, a_k)$ is not.\n\n$\\gcd(a_j, a_k),\\lcm(a_j,a_k)$ are as well.\n\nIf we started out with exactly $h$ numbers not divisible by $p^m$,\nthen in the final sequence $a'_1, \\dots, a'_n$, the numbers\n$a'_{h+1}, \\dots, a'_n$ are divisible by $p^m$ while the numbers\n$a'_1, \\dots, a'_h$ are not. Repeating this argument for each\npair $(p,m)$ such that $p^m$ divides the initial product\n$a_1,\\dots,a_n$, we can determine the exact prime factorization\nof each of $a'_1,\\dots,a'_n$. This proves that the final sequence\nis unique.\n\n\\textbf{Remark:}\n(by David Savitt and Noam Elkies)\nHere are two other ways to prove the termination.\nOne is to observe that $\\prod_j a_j^j$\nis \\emph{strictly} increasing at each step, and bounded above by\n$(a_1\\cdots a_n)^n$. The other is to notice that $a_1$ is nonincreasing\nbut always positive, so eventually becomes constant; then\n$a_2$ is nonincreasing but always positive, and so on.\n\n\\textbf{Reinterpretation:}\nFor each $p$, consider the sequence consisting of the\nexponents of $p$ in the prime factorizations of $a_1,\\dots,a_n$.\nAt each step, we pick two positions $i$ and $j$ such that the exponents\nof some prime $p$ are in the wrong order at positions $i$ and $j$.\nWe then sort these two position into the correct order for every prime $p$\nsimultaneously.\n\nIt is clear that this can only terminate with all sequences being sorted\ninto the correct order. We must still check that the process terminates;\nhowever, since all but finitely many of the exponent\nsequences consist of all zeroes,\nand each step makes a nontrivial switch in at least one of the other exponent\nsequences, it is enough to check the case of a single exponent sequence.\nThis can be done as in the first solution.\n\n\\textbf{Remark:}\nAbhinav Kumar suggests the following proof that the process always terminates\nin at most  $\\binom{n}{2}$ steps.\n(This is a variant of the worst-case analysis of the \\emph{bubble sort}\nalgorithm.)\n\nConsider the number of pairs $(k,l)$\nwith $1 \\leq k < l \\leq n$ such that $a_k$ does not divide $a_l$\n(call these \\emph{bad pairs}).\nAt each step, we find one bad pair $(i,j)$ and eliminate it, and we do not\ntouch any pairs that do not involve either $i$ or $j$.\nIf $i < k < j$, then neither of the pairs $(i,k)$ and $(k,j)$ can become\nbad,\nbecause $a_i$ is replaced by a divisor of itself, while $a_j$ is replaced by\na multiple of itself. If $k < i$, then $(k,i)$ can only become a bad pair if\n$a_k$ divided $a_i$ but not $a_j$, in which case $(k,j)$ stops being bad.\nSimilarly, if $k > j$, then $(i,k)$ and $(j,k)$\neither stay the same or switch status. Hence the number of bad pairs\ngoes down by at least 1 each time; since it is at most $\\binom{n}{2}$\nto begin with, this is an upper bound for the number of steps.\n\n\\textbf{Remark:}\nThis problem is closely related to the classification theorem for\nfinite abelian groups. Namely, if $a_1,\\dots,a_n$\nand $a'_1,\\dots,a'_n$ are the sequences obtained at two different\nsteps in the process, then the abelian groups\n$\\ZZ/a_1 \\ZZ \\times \\cdots \\times \\ZZ/a_n \\ZZ$\nand\n$\\ZZ/a'_1 \\ZZ \\times \\cdots \\times \\ZZ/a'_n \\ZZ$\nare isomorphic. The final sequence gives a canonical\npresentation of this group; the terms of this sequence are called the\n\\emph{elementary divisors} or \\emph{invariant factors} of the group.\n\n\\textbf{Remark:} (by Tom Belulovich)\nA \\emph{lattice} is a partially ordered set $L$ in which for\nany two $x,y \\in L$, there is a unique minimal element $z$ with $z \\geq\nx$ and $z \\geq y$, called the \\emph{join} and denoted $x \\wedge y$,\nand there is a unique maximal element $z$ with $z \\leq x$ and $z \\leq y$,\ncalled the \\emph{meet} and denoted $x \\vee y$. In terms of a lattice $L$,\none can pose the following generalization of the given problem.\nStart with $a_1,\\dots,a_n \\in L$. If $i < j$ but $a_i \\not\\leq a_j$,\nit is permitted to replace $a_i, a_j$ by $a_i \\vee a_j, a_i \\wedge a_j$,\nrespectively. The same argument as above shows that this always terminates\nin at most $\\binom{n}{2}$ steps. The question is, under what conditions on\nthe lattice $L$ is the final sequence uniquely determined by the initial\nsequence?\n\nIt turns out that this holds if and only if $L$ is \\emph{distributive},\ni.e., for any $x,y,z \\in L$,\n\\[\nx \\wedge (y \\vee z)\n= (x \\wedge y) \\vee (x \\wedge z).\n\\]\n(This is equivalent to the same axiom with the operations interchanged.)\nFor example, if $L$ is a \\emph{Boolean algebra}, i.e., the set of subsets\nof a given set $S$ under inclusion, then $\\wedge$ is union, $\\vee$\nis intersection, and the distributive law holds.\nConversely, any finite\ndistributive lattice is contained in a Boolean algebra by a theorem of\nBirkhoff. The correspondence takes each  $x \\in L$ to the set of\n$y \\in L$ such that $x \\geq y$ and $y$ cannot be written as a join\nof two elements of $L \\setminus \\{y\\}$. (See for instance\nBirkhoff, \\textit{Lattice Theory}, Amer. Math. Soc., 1967.)\n\nOn one hand, if $L$ is distributive, it can be shown that the $j$-th term\nof the final sequence is equal to the meet of $a_{i_1} \\wedge \\cdots\n\\wedge a_{i_j}$ over all sequences $1 \\leq i_1 < \\cdots < i_j \\leq n$.\nFor instance, this can be checked by forming the smallest subset $L'$\nof $L$ containing $a_1,\\dots,a_n$ and closed under meet and join,\nthen embedding $L'$ into a Boolean algebra using\nBirkhoff's theorem, then checking the claim for all Boolean algebras.\nIt can also be checked directly (as suggested by Nghi Nguyen)\nby showing that for $j=1,\\dots,n$,\nthe meet of all joins of $j$-element subsets of $a_1,\\dots,a_n$ is\ninvariant at each step.\n\nOn the other hand,\na lattice fails to be distributive if and only if\nit contains five elements $a,b,c,0,1$ such that either the only relations\namong them are implied by\n\\[\n1 \\geq a,b,c \\geq 0\n\\]\n(this lattice is sometimes called the \\emph{diamond}),\nor the only relations among them  are implied by\n\\[\n1 \\geq a \\geq b \\geq 0, \\qquad 1 \\geq c \\geq 0\n\\]\n(this lattice is sometimes called the \\emph{pentagon}).\n(For a proof, see the Birkhoff reference given above.) For each of these\nexamples, the initial sequence $a,b,c$ fails to determine the final\nsequence; for the diamond, we can end up with $0, *, 1$ for\nany of $* = a,b,c$, whereas for the pentagon we can end up with\n$0, *, 1$ for any of $* = a, b$.\n\nConsequently, the final sequence is determined by the initial sequence\nif and only if $L$ is distributive."
    }
  ]
}